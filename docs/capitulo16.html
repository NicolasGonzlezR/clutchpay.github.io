<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cap√≠tulo 16: Notificaciones en Frontend - ClutchPay</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>üí∞ ClutchPay</h1>
            <p class="subtitle">Cap√≠tulo 16: Notificaciones en Frontend</p>
        </div>
    </header>

    <nav class="main-nav">
        <div class="container">
            <a href="index.html">Inicio</a>
            <a href="capitulo16.html" class="active">Cap√≠tulo 16</a>
        </div>
    </nav>

    <main class="container">
        <div class="back-nav">
            <a href="index.html" class="back-btn">‚Üê Volver al √≠ndice</a>
        </div>

        <div class="chapter-content">
            <div class="chapter-header">
                <h1>Cap√≠tulo 16: Notificaciones en Frontend</h1>
            </div>

            <div class="video-embed">
                <iframe
                    src="https://drive.google.com/file/d/1wc_ONUymg6GEmPO-fZ-ECPmVvMNvpKsp/preview"
                    title="Video tutorial - Cap√≠tulo 16"
                    allow="autoplay; encrypted-media"
                    allowfullscreen
                ></iframe>
            </div>

            <div class="content-section">
                <h2>üìñ Contenido Completo</h2>
                <div class="markdown-body">
                    <h1>Implementaci√≥n del Sistema de Notificaciones</h1>
                    <p>En este tutorial se describe el proceso para implementar la funcionalidad completa del sistema de notificaciones en el proyecto, que incluye la gesti√≥n de notificaciones internas para eventos como la creaci√≥n y cancelaci√≥n de facturas, y la visualizaci√≥n de notificaciones en la interfaz de usuario.</p>
                    
                    <h2>1. Estructura de Archivos de Pruebas y Configuraci√≥n</h2>
                    <ul>
                        <li><strong>public/JS/internal-notifications.js</strong>: Este archivo maneja la l√≥gica para el sistema de notificaciones internas, permitiendo la visualizaci√≥n, actualizaci√≥n (marcar como le√≠das) y eliminaci√≥n de notificaciones.</li>
                        <li><strong>public/JS/dashboard-usuario.js</strong>: Se integra la l√≥gica del sistema de notificaciones con el dashboard del usuario, permitiendo la inicializaci√≥n y manejo global del sistema de notificaciones.</li>
                        <li><strong>app/api/invoices/route.ts</strong>: Aqu√≠ se realiza la notificaci√≥n cuando se crea una nueva factura, informando a los usuarios sobre la emisi√≥n de la misma.</li>
                        <li><strong>app/api/invoices/[id]/route.ts</strong>: Se env√≠a una notificaci√≥n cuando una factura es cancelada o eliminada.</li>
                        <li><strong>public/main.html</strong>: Se configura la interfaz de usuario con un bot√≥n que abre un modal para mostrar las notificaciones.</li>
                    </ul>
                    
                    <h2>2. public/JS/internal-notifications.js</h2>
                    <p>Este archivo contiene la implementaci√≥n del sistema de notificaciones internas de la aplicaci√≥n. El sistema permite visualizar las notificaciones en un modal, marcar las notificaciones como le√≠das y eliminar las notificaciones le√≠das.</p>
                    
                    <h3>Funcionalidades principales</h3>
                    <ul>
                        <li><strong>Inicializaci√≥n</strong>: El sistema de notificaciones se inicializa con la creaci√≥n de una instancia de <code>InternalNotifications</code>. Esta instancia maneja todas las operaciones relacionadas con la obtenci√≥n, visualizaci√≥n y actualizaci√≥n de las notificaciones.</li>
                        <li><strong>Obtenci√≥n de notificaciones</strong>: Mediante la funci√≥n <code>fetchNotifications</code>, el sistema obtiene las notificaciones desde el backend. Los datos recuperados incluyen el n√∫mero de notificaciones no le√≠das, y la lista de notificaciones que se deben mostrar.</li>
                        <li><strong>Interacci√≥n con el Modal</strong>: El modal de notificaciones permite a los usuarios visualizar todas las notificaciones disponibles. Adem√°s, los usuarios pueden realizar acciones como marcar todas las notificaciones como le√≠das o eliminar las notificaciones le√≠das.</li>
                        <li><strong>Acciones sobre notificaciones</strong>: Se han a√±adido funcionalidades para:
                            <ul>
                                <li><strong>Marcar como le√≠das</strong>: Permite al usuario marcar notificaciones espec√≠ficas o todas las notificaciones como le√≠das.</li>
                                <li><strong>Eliminar notificaciones</strong>: Permite eliminar todas las notificaciones le√≠das, ayudando a mantener limpio el sistema.</li>
                            </ul>
                        </li>
                    </ul>
                    
                    <h2>3. public/JS/dashboard-usuario.js</h2>
                    <p>Este archivo se encarga de integrar el sistema de notificaciones en el dashboard del usuario, proporcionando la l√≥gica necesaria para inicializar el sistema de notificaciones y permitir su acceso a trav√©s de la interfaz de usuario.</p>
                    
                    <h3>Cambios realizados</h3>
                    <ul>
                        <li><strong>Inicializaci√≥n del sistema de notificaciones</strong>: Se ha a√±adido la creaci√≥n de una instancia de <code>InternalNotifications</code> al cargar la p√°gina. La instancia se inicializa y se hace accesible globalmente para manejar las interacciones con las notificaciones.
                            <ul><li><strong>Objetivo</strong>: Permitir que los usuarios puedan acceder y manipular el sistema de notificaciones desde cualquier parte del dashboard.</li></ul>
                        </li>
                        <li><strong>Acceso global</strong>: La instancia de <code>notificationSystem</code> se hace accesible globalmente a trav√©s de <code>window.notificationSystem</code>, lo que permite su uso desde otras partes de la interfaz de usuario que necesiten interactuar con las notificaciones.</li>
                    </ul>
                    
                    <h2>4. app/api/invoices/route.ts</h2>
                    <p>Este archivo maneja las operaciones de la API relacionadas con las facturas. Una de las principales funcionalidades agregadas es la notificaci√≥n cuando se crea una nueva factura.</p>
                    
                    <h3>Cambios realizados</h3>
                    <ul>
                        <li><strong>Notificaci√≥n al crear una factura</strong>: Se ha integrado la funci√≥n <code>notifyInvoiceIssued(invoice)</code> para enviar una notificaci√≥n a los usuarios relacionados cuando una factura es creada. Esta notificaci√≥n informa sobre la emisi√≥n de la factura, garantizando que los usuarios est√©n al tanto de la nueva factura.</li>
                        <li><strong>Contexto de uso</strong>: La notificaci√≥n se env√≠a despu√©s de que una factura ha sido creada correctamente, asegurando que los usuarios, como el emisor o el deudor de la factura, reciban la notificaci√≥n correspondiente.</li>
                        <li><strong>Funcionalidad adicional</strong>: Adem√°s de crear facturas, se asegura que el sistema de notificaciones est√© bien integrado en el proceso de la creaci√≥n, activando notificaciones autom√°ticamente al generar nuevas facturas.</li>
                    </ul>
                    
                    <h3>Endpoint relevante</h3>
                    <ul>
                        <li><strong>POST /api/invoices</strong>: Este endpoint se encarga de crear una nueva factura y notificar a los usuarios sobre la emisi√≥n de la misma.</li>
                    </ul>
                    
                    <h2>5. app/api/invoices/[id]/route.ts</h2>
                    <p>Este archivo maneja las operaciones sobre facturas individuales, como obtener detalles, actualizar o eliminar facturas. En esta secci√≥n se ha a√±adido la capacidad de notificar a los usuarios cuando una factura es cancelada.</p>
                    
                    <h3>Cambios realizados</h3>
                    <ul>
                        <li><strong>Notificaci√≥n de cancelaci√≥n de factura</strong>: Cuando una factura es cancelada o eliminada, se llama a la funci√≥n <code>notifyInvoiceCanceled(invoice)</code>, lo que garantiza que los usuarios sean notificados sobre la cancelaci√≥n.</li>
                        <li><strong>Contexto de uso</strong>: Esta notificaci√≥n se env√≠a autom√°ticamente despu√©s de que una factura ha sido cancelada correctamente, informando a los usuarios sobre el cambio en el estado de la factura.</li>
                    </ul>
                    
                    <h3>Endpoint relevante</h3>
                    <ul>
                        <li><strong>DELETE /api/invoices/:id</strong>: Este endpoint se utiliza para cancelar o eliminar una factura, y en el proceso se env√≠a una notificaci√≥n a los usuarios relacionados.</li>
                    </ul>
                    
                    <h2>6. public/main.html</h2>
                    <p>Este archivo contiene el bot√≥n y el modal para manejar la visualizaci√≥n de notificaciones en la interfaz de usuario. Los cambios realizados aseguran que los usuarios puedan acceder a sus notificaciones de manera f√°cil y r√°pida.</p>
                    
                    <h3>Cambios realizados</h3>
                    <ul>
                        <li><strong>Bot√≥n de notificaciones</strong>: Se a√±adi√≥ un bot√≥n con el icono de campana que permite a los usuarios abrir el modal de notificaciones. El bot√≥n tambi√©n incluye un contador de notificaciones no le√≠das, que se actualiza din√°micamente seg√∫n las notificaciones disponibles.</li>
                        <li><strong>Modal de notificaciones</strong>: Se implement√≥ un modal que muestra la lista de notificaciones cuando el usuario hace clic en el bot√≥n de notificaciones. Este modal tambi√©n permite al usuario realizar acciones como marcar las notificaciones como le√≠das o eliminarlas si ya han sido le√≠das.</li>
                        <li><strong>Dise√±o del modal</strong>: El dise√±o es sencillo, con un encabezado para indicar que se trata de notificaciones, botones para marcar todas como le√≠das o eliminar las le√≠das, y un √°rea donde se listan las notificaciones.</li>
                    </ul>
                    
                    <h3>Elementos relevantes</h3>
                    <ul>
                        <li><strong>Bot√≥n de notificaciones</strong>: Se muestra un icono con un contador de notificaciones no le√≠das.</li>
                        <li><strong>Modal</strong>: Contiene opciones para marcar todas las notificaciones como le√≠das o eliminarlas.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="chapter-nav">
            <div class="prev">
                <a href="capitulo15.html">
                    <span class="nav-label">‚Üê Anterior</span>
                    <span class="nav-title">Cap√≠tulo 15: Backend Notificaciones</span>
                </a>
            </div>
            <div class="next">
                <a href="index.html">
                    <span class="nav-label">Siguiente ‚Üí</span>
                    <span class="nav-title">√çndice Principal</span>
                </a>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>üìö Material educativo para aprender desarrollo full-stack moderno</p>
            <p>Basado en el proyecto <a href="https://github.com/GCousido/ClutchPay" target="_blank">ClutchPay</a></p>
        </div>
    </footer>
</body>
</html>