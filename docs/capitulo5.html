<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cap√≠tulo 5: Backend de Usuarios - ClutchPay</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>üí∞ ClutchPay</h1>
            <p class="subtitle">Cap√≠tulo 5: Backend de Usuarios</p>
        </div>
    </header>

    <nav class="main-nav">
        <div class="container">
            <a href="index.html">Inicio</a>
            <a href="capitulo5.html" class="active">Cap√≠tulo 5</a>
        </div>
    </nav>

    <main class="container">
        <div class="back-nav">
            <a href="index.html" class="back-btn">‚Üê Volver al √≠ndice</a>
        </div>

        <div class="chapter-content">
            <div class="chapter-header">
                <h1>Cap√≠tulo 5: Backend de Usuarios</h1>
            </div>

            <div class="video-embed">
                <iframe
                    src="https://drive.google.com/file/d/1pai1iow8CWJIYfomDnTJhaFKPRc5dq4g/preview"
                    title="Video tutorial - Cap√≠tulo 5"
                    allow="autoplay; encrypted-media"
                    allowfullscreen
                ></iframe>
            </div>

            <div class="content-section">
                <h2>üìñ Contenido Completo</h2>
                <div class="markdown-body">
                    <h1>Configuraci√≥n del Backend: Validaciones, Seguridad y Endpoints de Usuarios</h1>
                    <p>En este tutorial se explicar√° paso a paso c√≥mo est√° organizado el backend encargado de validar usuarios, gestionar autenticaci√≥n, controlar el acceso y ofrecer endpoints relacionados con perfiles y contactos.</p>
                    
                    <ol>
                        <li>
                            <strong>Estructura de archivos del backend</strong>
                            <ul>
                                <li><strong>validations/users.ts</strong>: Se a√±adir√°n funciones referentes a las nuevas validaciones respecto a perfiles de usuario, as√≠ como los esquemas utilizados para crear o actualizar perfiles y a√±adir contactos.</li>
                                <li><strong>api-helpers.ts</strong>: Re√∫ne funciones √∫tiles para el backend, como la comprobaci√≥n del usuario autenticado, la validaci√≥n general de datos recibidos, el control de permisos entre usuarios y la gesti√≥n centralizada de errores y paginaci√≥n.</li>
                                <li><strong>/api/users/route.ts</strong>: Controla el endpoint encargado de devolver un listado paginado de todos los usuarios registrados, asegurando que solo usuarios con sesi√≥n pueden acceder.</li>
                                <li><strong>/api/users/[id]/route.ts</strong>: Gestiona la obtenci√≥n y actualizaci√≥n del perfil individual de un usuario, garantizando que cada persona solo pueda acceder o modificar su propia informaci√≥n.</li>
                                <li><strong>/api/users/[id]/contacts/route.ts</strong>: Implementa el sistema de contactos entre usuarios, permitiendo consultar la lista de contactos o a√±adir nuevos, siempre comprobando identidades y validaciones necesarias.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Validaciones de datos con validations/users.ts</strong><br>
                            Este archivo se actualizar√° para incluir las reglas que aseguren que los datos de edici√≥n enviados por el usuario sean correctos antes de llegar a la base de datos: Se actualizar√°n los esquemas que controlan c√≥mo se editan y c√≥mo se a√±aden contactos en relaciones muchos a muchos.
                        </li>
                        <li>
                            <strong>Herramientas de autenticaci√≥n, autorizaci√≥n y manejo de errores (api-helpers.ts)</strong><br>
                            Este archivo centralizar√° varias tareas cr√≠ticas del backend:
                            <ul>
                                <li>Comprueba si el usuario que realiza la petici√≥n tiene una sesi√≥n activa.</li>
                                <li>Verifica que los usuarios solo puedan acceder o modificar su propia informaci√≥n, salvo en entornos de desarrollo.</li>
                                <li>Convierte cualquier error del sistema o de validaci√≥n en una respuesta consistente y clara para el cliente.</li>
                                <li>Valida los cuerpos de las peticiones usando los esquemas previamente definidos.</li>
                                <li>Gestiona paginaci√≥n a partir de par√°metros como p√°gina, l√≠mite y desplazamiento.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Listado de usuarios (api/users/route.ts)</strong><br>
                            Este archivo controlar√° el endpoint que devuelve un listado paginado de usuarios:
                            <ul>
                                <li>Solo permite el acceso si existe una sesi√≥n activa.</li>
                                <li>Analiza los par√°metros de la URL para determinar p√°gina, l√≠mite y desplazamiento.</li>
                                <li>Consulta cu√°ntos usuarios hay en total.</li>
                                <li>Devuelve un conjunto paginado con informaci√≥n esencial del usuario: correo, nombre, apellidos, tel√©fono, pa√≠s, imagen, fecha de creaci√≥n y actualizaci√≥n.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Gesti√≥n de perfiles individuales (api/users/[id]/route.ts)</strong><br>
                            Este archivo estar√° centrado en la gesti√≥n del perfil personal de cada usuario, tanto para consultarlo como para actualizarlo.
                            <p>Para la lectura del perfil:</p>
                            <ul>
                                <li>Comprueba que la persona est√© autenticada.</li>
                                <li>Verifica que el usuario acceda solo a su propio perfil.</li>
                                <li>Devuelve los datos del perfil sin incluir informaci√≥n sensible.</li>
                            </ul>
                            <p>Para la actualizaci√≥n:</p>
                            <ul>
                                <li>Se confirma la identidad del usuario.</li>
                                <li>Se reciben los datos enviados desde el cliente y se validan con las reglas establecidas.</li>
                                <li>Se actualizan √∫nicamente los campos permitidos.</li>
                                <li>Se devuelve el perfil modificado.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Gesti√≥n de contactos entre usuarios (api/users/[id]/contacts/route.ts)</strong><br>
                            Aqu√≠ se encontrar√° el sistema que permite a un usuario mantener una lista de contactos.
                            <p>Para consultar los contactos:</p>
                            <ul>
                                <li>Se exige autenticaci√≥n.</li>
                                <li>Se interpreta el identificador del usuario directamente desde el path.</li>
                                <li>Solo se permite acceder a la propia lista de contactos.</li>
                                <li>Se obtiene el n√∫mero total de contactos y se aplica paginaci√≥n.</li>
                                <li>Se devuelven los datos esenciales de cada contacto.</li>
                            </ul>
                            <p>Para a√±adir un nuevo contacto:</p>
                            <ul>
                                <li>Se validan los datos enviados en el cuerpo de la petici√≥n.</li>
                                <li>Se impide que un usuario se a√±ada a s√≠ mismo.</li>
                                <li>Se comprueba que el contacto exista.</li>
                                <li>Se revisa que no est√© ya en la lista de contactos.</li>
                                <li>Se agrega la relaci√≥n en la base de datos y se devuelve la informaci√≥n del contacto a√±adido.</li>
                                <li>Si se detectan duplicidades o errores de validaci√≥n, se responde de forma clara y estructurada.</li>
                            </ul>
                        </li>
                    </ol>
                </div>
            </div>
        </div>

        <div class="chapter-nav">
            <div class="prev">
                <a href="capitulo4.html">
                    <span class="nav-label">‚Üê Anterior</span>
                    <span class="nav-title">Cap√≠tulo 4: Frontend de Login</span>
                </a>
            </div>
            <div class="next">
                <a href="capitulo6.html">
                    <span class="nav-label">Siguiente ‚Üí</span>
                    <span class="nav-title">Cap√≠tulo 6: Frontend de Usuarios</span>
                </a>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>üìö Material educativo para aprender desarrollo full-stack moderno</p>
            <p>Basado en el proyecto <a href="https://github.com/GCousido/ClutchPay" target="_blank">ClutchPay</a></p>
        </div>
    </footer>
</body>
</html>